{"ast":null,"code":"var _jsxFileName = \"/Users/Server/student/cs291a/githubPagesHostedReact/src/App.jsx\";\nimport { Component } from \"react\";\nimport \"./App.css\";\nimport Compose from \"./components/Compose\";\nimport LoginForm from \"./components/LoginForm\";\nimport MessageList from \"./components/MessageList\";\nimport UserList from \"./components/UserList\";\nimport { Grid, Paper, AppBar } from '@mui/material';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      userList: [],\n      events: [],\n      username: \"\",\n      password: \"\",\n      url: \"http://localhost:3000\",\n      needToLogin: true,\n      streamToken: \"\",\n      header: 'Chat',\n      composePlaceholder: 'Enter a message to send'\n    };\n    this.serve = this.serve.bind(this);\n    this.login = this.login.bind(this);\n    this.setUsername = this.setUsername.bind(this);\n    this.setPassword = this.setPassword.bind(this);\n  }\n\n  login() {\n    var request = new XMLHttpRequest();\n    var form = new FormData();\n    form.append(\"password\", this.state.password);\n    form.append(\"username\", this.state.username);\n    request.open(\"POST\", this.state.url + \"/login\");\n    var that = this;\n\n    request.onreadystatechange = function () {\n      if (this.readyState !== 4) return;\n\n      if (this.status === 201) {\n        const data = JSON.parse(this.responseText);\n        sessionStorage.setItem('messageToken', data.message_token);\n        that.setState({\n          password: \"\",\n          username: \"Loading...\",\n          streamToken: data.stream_token,\n          needToLogin: false\n        });\n        that.serve();\n      } else if (this.status === 403) {\n        alert(\"Invalid username or password\");\n      } else if (this.status === 409) {\n        alert(that.state.username + \" is already logged in\");\n      } else {\n        alert(this.status + \" failure to /login\");\n      }\n    };\n\n    request.send(form);\n  }\n\n  serve() {\n    const server = new EventSource(`${this.state.url}/stream/${this.state.streamToken}`);\n    server.addEventListener(\"Part\", event => {\n      event = { ...JSON.parse(event.data),\n        type: 'Part'\n      };\n      var temp = this.state.userList;\n      temp.splice(this.state.userList.indexOf(event.user), 1);\n      this.setState(prevState => ({\n        userList: temp,\n        events: [...prevState.events, event],\n        needToLogin: false\n      }));\n    }, false);\n    server.addEventListener(\"open\", event => {\n      this.setState(prevState => ({\n        username: \"\",\n        needToLogin: false\n      }));\n    }, false);\n    server.addEventListener(\"Message\", event => {\n      var data = { ...JSON.parse(event.data),\n        type: 'Message'\n      };\n      this.setState(prevState => ({\n        events: [...prevState.events, data],\n        needToLogin: false\n      }));\n    }, false);\n    server.addEventListener(\"Join\", event => {\n      var data = JSON.parse(event.data);\n      var santizedData = { ...data,\n        type: 'Join'\n      };\n      this.setState(prevState => ({\n        header: 'Chat',\n        needToLogin: false,\n        events: [...prevState.events, santizedData]\n      }));\n\n      if (this.state.userList.includes(data.user)) {\n        this.setState(prevState => ({\n          header: 'Chat'\n        }));\n        return;\n      }\n\n      this.setState(prevState => ({\n        userList: [...prevState.userList, data.user]\n      }));\n    }, false);\n    server.addEventListener(\"Disconnect\", () => {\n      server.close();\n      this.disconnect();\n      this.setState({\n        events: []\n      });\n    }, false);\n    server.addEventListener(\"ServerStatus\", event => {\n      var parsedEvent = JSON.parse(event.data);\n      var santizedData = {\n        message: parsedEvent.status,\n        created: parsedEvent.created,\n        type: 'Status'\n      };\n      this.setState(prevState => ({\n        events: [...this.state.events, santizedData]\n      }));\n    }, false);\n    server.addEventListener(\"Users\", event => {\n      this.setState(prevState => ({\n        userList: JSON.parse(event.data).users\n      }));\n    }, false);\n    server.addEventListener(\"error\", event => {\n      if (event.target.readyState === 2) {\n        this.disconnect();\n      } else {\n        this.setState(prevState => ({\n          header: \"Disconnected, retrying\"\n        }));\n        console.log(\"Disconnected, retrying\");\n      }\n    }, false);\n\n    server.onerror = _event => {\n      console.log(\"Connection lost, reestablishing\");\n    };\n  }\n\n  setUsername(value) {\n    this.setState({\n      username: value\n    });\n  }\n\n  setPassword(value) {\n    this.setState({\n      password: value\n    });\n  }\n\n  setURL(value) {\n    this.setState({\n      url: value\n    });\n  }\n\n  disconnect() {\n    this.setState(prevState => ({\n      needToLogin: true,\n      messageToken: \"\",\n      streamToken: \"\",\n      userList: []\n    }));\n  }\n\n  render() {\n    // debugger\n    return this.state.needToLogin ? /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"header\", {\n        children: /*#__PURE__*/_jsxDEV(AppBar, {\n          style: {\n            textAlign: 'center'\n          },\n          children: 'Log In to View Chat'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Not logged in\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(LoginForm, {\n        url: this.state.url,\n        setURL: this.setURL,\n        setUsername: this.setUsername,\n        setPassword: this.setPassword,\n        needToLogin: this.state.needToLogin,\n        serve: this.serve,\n        login: this.login,\n        username: this.state.username,\n        password: this.state.password\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"header\", {\n        children: /*#__PURE__*/_jsxDEV(AppBar, {\n          style: {\n            textAlign: 'center'\n          },\n          children: this.state.header\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(LoginForm, {\n        setUsername: this.setUsername,\n        setPassword: this.setPassword,\n        needToLogin: this.state.needToLogin,\n        serve: this.serve,\n        login: this.login,\n        username: this.state.username,\n        password: this.state.password\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        mt: 2,\n        container: true,\n        spacing: 2,\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 8,\n          md: 8,\n          children: /*#__PURE__*/_jsxDEV(Paper, {\n            style: {\n              display: 'flex',\n              flexWrap: 'wrap',\n              flexDirection: 'column'\n            },\n            children: [/*#__PURE__*/_jsxDEV(MessageList, {\n              events: this.state.events\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 154,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Compose, {\n              url: this.state.url,\n              needToLogin: this.state.needToLogin\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 155,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 153,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 4,\n          md: 4,\n          children: /*#__PURE__*/_jsxDEV(Paper, {\n            children: /*#__PURE__*/_jsxDEV(UserList, {\n              userList: this.state.userList\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 160,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 159,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true);\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/Server/student/cs291a/githubPagesHostedReact/src/App.jsx"],"names":["Component","Compose","LoginForm","MessageList","UserList","Grid","Paper","AppBar","App","constructor","props","state","userList","events","username","password","url","needToLogin","streamToken","header","composePlaceholder","serve","bind","login","setUsername","setPassword","request","XMLHttpRequest","form","FormData","append","open","that","onreadystatechange","readyState","status","data","JSON","parse","responseText","sessionStorage","setItem","message_token","setState","stream_token","alert","send","server","EventSource","addEventListener","event","type","temp","splice","indexOf","user","prevState","santizedData","includes","close","disconnect","parsedEvent","message","created","users","target","console","log","onerror","_event","value","setURL","messageToken","render","textAlign","display","flexWrap","flexDirection"],"mappings":"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","sourcesContent":["import { Component } from \"react\";\nimport \"./App.css\";\nimport Compose from \"./components/Compose\";\nimport LoginForm from \"./components/LoginForm\";\nimport MessageList from \"./components/MessageList\";\nimport UserList from \"./components/UserList\"\nimport { Grid, Paper, AppBar } from '@mui/material'\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      userList: [],\n      events: [],\n      username:\"\",\n      password:\"\",\n      url: \"http://localhost:3000\",\n      needToLogin: true,\n      streamToken: \"\",\n      header: 'Chat',\n      composePlaceholder: 'Enter a message to send'\n    }\n    this.serve = this.serve.bind(this)\n    this.login = this.login.bind(this)\n    this.setUsername = this.setUsername.bind(this)\n    this.setPassword = this.setPassword.bind(this)\n  }\n\n\n    login() {\n      var request = new XMLHttpRequest();\n      var form = new FormData();\n      form.append(\"password\", this.state.password);\n      form.append(\"username\", this.state.username);\n      request.open(\"POST\", this.state.url + \"/login\");\n      var that = this;\n      request.onreadystatechange = function() {\n          if (this.readyState !== 4) return;\n          if (this.status === 201) {\n              const data = JSON.parse(this.responseText);\n              sessionStorage.setItem('messageToken', data.message_token)\n              that.setState({\n                password: \"\",\n                username: \"Loading...\", \n                streamToken: data.stream_token,\n                needToLogin: false\n              })\n              that.serve();\n          } else if (this.status === 403) {\n              alert(\"Invalid username or password\");\n          } else if (this.status === 409) {\n              alert(that.state.username + \" is already logged in\");\n          } else {\n              alert(this.status + \" failure to /login\");\n          }\n      }\n      request.send(form);\n    }\n\n    serve(){\n      const server = new EventSource(`${this.state.url}/stream/${this.state.streamToken}`);\n      server.addEventListener(\"Part\", (event) =>{\n        event = {...JSON.parse(event.data), type: 'Part'}\n        var temp = this.state.userList\n        temp.splice(this.state.userList.indexOf(event.user), 1)\n        this.setState(prevState => ({userList: temp, \n          events: [...prevState.events, event], needToLogin:false})\n      )}, false)\n      server.addEventListener(\"open\", (event) =>{\n        this.setState(prevState => ({username: \"\", needToLogin: false}))\n      }, false)\n      server.addEventListener(\"Message\", (event) => {\n        var data = {...JSON.parse(event.data), type: 'Message'}\n        this.setState(prevState => ({events: [...prevState.events, data], needToLogin:false}))\n      }, false);\n      server.addEventListener(\"Join\", (event) => {\n        var data = JSON.parse(event.data);\n        var santizedData = {...data, type: 'Join'}\n        this.setState(prevState => ({header: 'Chat', needToLogin: false, events: [...prevState.events, santizedData]}))\n        if(this.state.userList.includes(data.user)) { this.setState(prevState => ({header: 'Chat'})); return}\n        this.setState(prevState => ({userList: [...prevState.userList, data.user]}))\n      }, false);\n      server.addEventListener(\n        \"Disconnect\",\n        () => {\n            server.close();\n            this.disconnect()\n            this.setState({events: []})\n        },\n        false\n    );\n      server.addEventListener(\"ServerStatus\", (event) => {\n        var parsedEvent = JSON.parse(event.data)\n        var santizedData = {message: parsedEvent.status, created: parsedEvent.created, type: 'Status'}\n        this.setState(prevState => ({events: [...this.state.events, santizedData]}))\n      }, false);\n      server.addEventListener(\"Users\", (event => {\n        this.setState(prevState => ({ userList: JSON.parse(event.data).users}))\n      }), false);\n      server.addEventListener(\n        \"error\",\n        (event) => {\n            if (event.target.readyState === 2) {\n                this.disconnect();\n            } else {\n                this.setState(prevState => ({header: \"Disconnected, retrying\"}))\n                console.log(\"Disconnected, retrying\");\n            }\n        },\n        false\n    );\n      server.onerror = (_event) => {\n        console.log(\"Connection lost, reestablishing\");\n      };\n    }\n\n    setUsername(value){\n      this.setState({username: value})\n    }\n\n    setPassword(value){\n      this.setState({password: value})\n    }\n    setURL(value){\n      this.setState({url: value})\n    }\n\n    disconnect(){\n      this.setState(prevState => ({needToLogin: true, messageToken: \"\", streamToken: \"\", userList: []}))\n    }\n\n\n  render() {\n    // debugger\n\n    return this.state.needToLogin? ( \n      <>\n        <header>\n          <AppBar style={{textAlign: 'center'}}>{'Log In to View Chat'}</AppBar>\n        </header>\n        <p>Not logged in</p>\n        <LoginForm url={this.state.url} setURL={this.setURL} setUsername={this.setUsername} setPassword={this.setPassword} needToLogin={this.state.needToLogin} serve={this.serve} login={this.login} username={this.state.username} password={this.state.password}/>\n      </>\n      ) : (\n      <>\n        <header>\n          <AppBar style={{textAlign: 'center'}}>{this.state.header}</AppBar>\n        </header>\n        <LoginForm setUsername={this.setUsername} setPassword={this.setPassword} needToLogin={this.state.needToLogin} serve={this.serve} login={this.login} username={this.state.username} password={this.state.password}/>\n        <Grid mt={2} container spacing={2}>\n          <Grid item xs={8} md={8}>\n            <Paper style={{display: 'flex', flexWrap: 'wrap', flexDirection: 'column'}}>\n              <MessageList events={this.state.events}/>\n              <Compose url={this.state.url} needToLogin={this.state.needToLogin}/>\n            </Paper>\n          </Grid>\n          <Grid item xs={4} md={4}>\n            <Paper >\n              <UserList userList={this.state.userList} />\n            </Paper>\n          </Grid>\n        </Grid>\n      </>\n    );\n  }\n}\nexport default App;\n"]},"metadata":{},"sourceType":"module"}