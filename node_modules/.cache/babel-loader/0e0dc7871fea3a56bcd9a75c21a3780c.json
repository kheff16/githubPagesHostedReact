{"ast":null,"code":"import _toConsumableArray from\"/Users/Server/student/cs291a/githubPagesHostedReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/Server/student/cs291a/githubPagesHostedReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/Users/Server/student/cs291a/githubPagesHostedReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/Server/student/cs291a/githubPagesHostedReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/Server/student/cs291a/githubPagesHostedReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/Server/student/cs291a/githubPagesHostedReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/Server/student/cs291a/githubPagesHostedReact/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import{Component}from\"react\";import\"./App.css\";import Compose from\"./components/Compose\";import LoginForm from\"./components/LoginForm\";import MessageList from\"./components/MessageList\";import UserList from\"./components/UserList\";import{Grid,Paper,AppBar}from'@mui/material';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var App=/*#__PURE__*/function(_Component){_inherits(App,_Component);var _super=_createSuper(App);function App(props){var _this;_classCallCheck(this,App);_this=_super.call(this,props);_this.state={userList:[],events:[],username:\"\",password:\"\",needToLogin:true,streamToken:\"\",header:'Chat',composePlaceholder:'Enter a message to send'};_this.serve=_this.serve.bind(_assertThisInitialized(_this));_this.login=_this.login.bind(_assertThisInitialized(_this));_this.setUsername=_this.setUsername.bind(_assertThisInitialized(_this));_this.setPassword=_this.setPassword.bind(_assertThisInitialized(_this));return _this;}_createClass(App,[{key:\"login\",value:function login(){var request=new XMLHttpRequest();var form=new FormData();form.append(\"password\",this.state.password);form.append(\"username\",this.state.username);request.open(\"POST\",process.env.REACT_APP_BASE_URL+\"/login\");var that=this;request.onreadystatechange=function(){if(this.readyState!==4)return;if(this.status===201){var data=JSON.parse(this.responseText);sessionStorage.setItem('messageToken',data.message_token);that.setState({password:\"\",username:\"Loading...\",streamToken:data.stream_token,needToLogin:false});that.serve();}else if(this.status===403){alert(\"Invalid username or password\");}else if(this.status===409){alert(that.state.username+\" is already logged in\");}else{alert(this.status+\" failure to /login\");}};request.send(form);}},{key:\"serve\",value:function serve(){var _this2=this;var server=new EventSource(\"\".concat(process.env.REACT_APP_BASE_URL,\"/stream/\").concat(this.state.streamToken));server.addEventListener(\"Part\",function(event){event=_objectSpread(_objectSpread({},JSON.parse(event.data)),{},{type:'Part'});var temp=_this2.state.userList;temp.splice(_this2.state.userList.indexOf(event.user),1);_this2.setState(function(prevState){return{userList:temp,events:[].concat(_toConsumableArray(prevState.events),[event]),needToLogin:false};});},false);server.addEventListener(\"open\",function(event){_this2.setState(function(prevState){return{username:\"\",needToLogin:false};});},false);server.addEventListener(\"Message\",function(event){var data=_objectSpread(_objectSpread({},JSON.parse(event.data)),{},{type:'Message'});_this2.setState(function(prevState){return{events:[].concat(_toConsumableArray(prevState.events),[data]),needToLogin:false};});},false);server.addEventListener(\"Join\",function(event){var data=JSON.parse(event.data);var santizedData=_objectSpread(_objectSpread({},data),{},{type:'Join'});_this2.setState(function(prevState){return{header:'Chat',needToLogin:false,events:[].concat(_toConsumableArray(prevState.events),[santizedData])};});if(_this2.state.userList.includes(data.user)){_this2.setState(function(prevState){return{header:'Chat'};});return;}_this2.setState(function(prevState){return{userList:[].concat(_toConsumableArray(prevState.userList),[data.user])};});},false);server.addEventListener(\"Disconnect\",function(){server.close();_this2.disconnect();_this2.setState({events:[]});},false);server.addEventListener(\"ServerStatus\",function(event){var parsedEvent=JSON.parse(event.data);var santizedData={message:parsedEvent.status,created:parsedEvent.created,type:'Status'};_this2.setState(function(prevState){return{events:[].concat(_toConsumableArray(_this2.state.events),[santizedData])};});},false);server.addEventListener(\"Users\",function(event){_this2.setState(function(prevState){return{userList:JSON.parse(event.data).users};});},false);server.addEventListener(\"error\",function(event){if(event.target.readyState===2){_this2.disconnect();}else{_this2.setState(function(prevState){return{header:\"Disconnected, retrying\"};});console.log(\"Disconnected, retrying\");}},false);server.onerror=function(_event){console.log(\"Connection lost, reestablishing\");};}},{key:\"setUsername\",value:function setUsername(value){this.setState({username:value});}},{key:\"setPassword\",value:function setPassword(value){this.setState({password:value});}},{key:\"disconnect\",value:function disconnect(){this.setState(function(prevState){return{needToLogin:true,messageToken:\"\",streamToken:\"\",userList:[]};});}},{key:\"render\",value:function render(){// debugger\nreturn this.state.needToLogin?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"header\",{children:/*#__PURE__*/_jsx(AppBar,{style:{textAlign:'center'},children:'Log In to View Chat'})}),/*#__PURE__*/_jsx(\"p\",{children:\"Not logged in\"}),/*#__PURE__*/_jsx(LoginForm,{setUsername:this.setUsername,setPassword:this.setPassword,needToLogin:this.state.needToLogin,serve:this.serve,login:this.login,username:this.state.username,password:this.state.password})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"header\",{children:/*#__PURE__*/_jsx(AppBar,{style:{textAlign:'center'},children:this.state.header})}),/*#__PURE__*/_jsx(LoginForm,{setUsername:this.setUsername,setPassword:this.setPassword,needToLogin:this.state.needToLogin,serve:this.serve,login:this.login,username:this.state.username,password:this.state.password}),/*#__PURE__*/_jsxs(Grid,{mt:2,container:true,spacing:2,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:8,md:8,children:/*#__PURE__*/_jsxs(Paper,{style:{display:'flex',flexWrap:'wrap',flexDirection:'column'},children:[/*#__PURE__*/_jsx(MessageList,{events:this.state.events}),/*#__PURE__*/_jsx(Compose,{needToLogin:this.state.needToLogin})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:4,md:4,children:/*#__PURE__*/_jsx(Paper,{children:/*#__PURE__*/_jsx(UserList,{userList:this.state.userList})})})]})]});}}]);return App;}(Component);export default App;","map":{"version":3,"sources":["/Users/Server/student/cs291a/githubPagesHostedReact/src/App.jsx"],"names":["Component","Compose","LoginForm","MessageList","UserList","Grid","Paper","AppBar","App","props","state","userList","events","username","password","needToLogin","streamToken","header","composePlaceholder","serve","bind","login","setUsername","setPassword","request","XMLHttpRequest","form","FormData","append","open","process","env","REACT_APP_BASE_URL","that","onreadystatechange","readyState","status","data","JSON","parse","responseText","sessionStorage","setItem","message_token","setState","stream_token","alert","send","server","EventSource","addEventListener","event","type","temp","splice","indexOf","user","prevState","santizedData","includes","close","disconnect","parsedEvent","message","created","users","target","console","log","onerror","_event","value","messageToken","textAlign","display","flexWrap","flexDirection"],"mappings":"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","sourcesContent":["import { Component } from \"react\";\nimport \"./App.css\";\nimport Compose from \"./components/Compose\";\nimport LoginForm from \"./components/LoginForm\";\nimport MessageList from \"./components/MessageList\";\nimport UserList from \"./components/UserList\"\nimport { Grid, Paper, AppBar } from '@mui/material'\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      userList: [],\n      events: [],\n      username:\"\",\n      password:\"\",\n      needToLogin: true,\n      streamToken: \"\",\n      header: 'Chat',\n      composePlaceholder: 'Enter a message to send'\n    }\n    this.serve = this.serve.bind(this)\n    this.login = this.login.bind(this)\n    this.setUsername = this.setUsername.bind(this)\n    this.setPassword = this.setPassword.bind(this)\n  }\n\n\n    login() {\n      var request = new XMLHttpRequest();\n      var form = new FormData();\n      form.append(\"password\", this.state.password);\n      form.append(\"username\", this.state.username);\n      request.open(\"POST\", process.env.REACT_APP_BASE_URL + \"/login\");\n      var that = this;\n      request.onreadystatechange = function() {\n          if (this.readyState !== 4) return;\n          if (this.status === 201) {\n              const data = JSON.parse(this.responseText);\n              sessionStorage.setItem('messageToken', data.message_token)\n              that.setState({\n                password: \"\",\n                username: \"Loading...\", \n                streamToken: data.stream_token,\n                needToLogin: false\n              })\n              that.serve();\n          } else if (this.status === 403) {\n              alert(\"Invalid username or password\");\n          } else if (this.status === 409) {\n              alert(that.state.username + \" is already logged in\");\n          } else {\n              alert(this.status + \" failure to /login\");\n          }\n      }\n      request.send(form);\n    }\n\n    serve(){\n      const server = new EventSource(`${process.env.REACT_APP_BASE_URL}/stream/${this.state.streamToken}`);\n      server.addEventListener(\"Part\", (event) =>{\n        event = {...JSON.parse(event.data), type: 'Part'}\n        var temp = this.state.userList\n        temp.splice(this.state.userList.indexOf(event.user), 1)\n        this.setState(prevState => ({userList: temp, \n          events: [...prevState.events, event], needToLogin:false})\n      )}, false)\n      server.addEventListener(\"open\", (event) =>{\n        this.setState(prevState => ({username: \"\", needToLogin: false}))\n      }, false)\n      server.addEventListener(\"Message\", (event) => {\n        var data = {...JSON.parse(event.data), type: 'Message'}\n        this.setState(prevState => ({events: [...prevState.events, data], needToLogin:false}))\n      }, false);\n      server.addEventListener(\"Join\", (event) => {\n        var data = JSON.parse(event.data);\n        var santizedData = {...data, type: 'Join'}\n        this.setState(prevState => ({header: 'Chat', needToLogin: false, events: [...prevState.events, santizedData]}))\n        if(this.state.userList.includes(data.user)) { this.setState(prevState => ({header: 'Chat'})); return}\n        this.setState(prevState => ({userList: [...prevState.userList, data.user]}))\n      }, false);\n      server.addEventListener(\n        \"Disconnect\",\n        () => {\n            server.close();\n            this.disconnect()\n            this.setState({events: []})\n        },\n        false\n    );\n      server.addEventListener(\"ServerStatus\", (event) => {\n        var parsedEvent = JSON.parse(event.data)\n        var santizedData = {message: parsedEvent.status, created: parsedEvent.created, type: 'Status'}\n        this.setState(prevState => ({events: [...this.state.events, santizedData]}))\n      }, false);\n      server.addEventListener(\"Users\", (event => {\n        this.setState(prevState => ({ userList: JSON.parse(event.data).users}))\n      }), false);\n      server.addEventListener(\n        \"error\",\n        (event) => {\n            if (event.target.readyState === 2) {\n                this.disconnect();\n            } else {\n                this.setState(prevState => ({header: \"Disconnected, retrying\"}))\n                console.log(\"Disconnected, retrying\");\n            }\n        },\n        false\n    );\n      server.onerror = (_event) => {\n        console.log(\"Connection lost, reestablishing\");\n      };\n    }\n\n    setUsername(value){\n      this.setState({username: value})\n    }\n\n    setPassword(value){\n      this.setState({password: value})\n    }\n\n    disconnect(){\n      this.setState(prevState => ({needToLogin: true, messageToken: \"\", streamToken: \"\", userList: []}))\n    }\n\n\n  render() {\n    // debugger\n\n    return this.state.needToLogin? ( \n      <>\n        <header>\n          <AppBar style={{textAlign: 'center'}}>{'Log In to View Chat'}</AppBar>\n        </header>\n        <p>Not logged in</p>\n        <LoginForm setUsername={this.setUsername} setPassword={this.setPassword} needToLogin={this.state.needToLogin} serve={this.serve} login={this.login} username={this.state.username} password={this.state.password}/>\n      </>\n      ) : (\n      <>\n        <header>\n          <AppBar style={{textAlign: 'center'}}>{this.state.header}</AppBar>\n        </header>\n        <LoginForm setUsername={this.setUsername} setPassword={this.setPassword} needToLogin={this.state.needToLogin} serve={this.serve} login={this.login} username={this.state.username} password={this.state.password}/>\n        <Grid mt={2} container spacing={2}>\n          <Grid item xs={8} md={8}>\n            <Paper style={{display: 'flex', flexWrap: 'wrap', flexDirection: 'column'}}>\n              <MessageList events={this.state.events}/>\n              <Compose needToLogin={this.state.needToLogin}/>\n            </Paper>\n          </Grid>\n          <Grid item xs={4} md={4}>\n            <Paper >\n              <UserList userList={this.state.userList} />\n            </Paper>\n          </Grid>\n        </Grid>\n      </>\n    );\n  }\n}\nexport default App;\n"]},"metadata":{},"sourceType":"module"}