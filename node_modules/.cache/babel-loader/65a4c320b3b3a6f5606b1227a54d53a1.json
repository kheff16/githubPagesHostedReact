{"ast":null,"code":"var _jsxFileName = \"/app/src/App.jsx\";\nimport { Component } from \"react\";\nimport \"./App.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      username: \"\",\n      password: \"\",\n      needToLogin: true,\n      messageToken: \"\",\n      streamToken: \"\",\n      url: \"https://chat.cs291.com\"\n    };\n    this.serve = this.serve.bind(this);\n    this.login = this.login.bind(this);\n  }\n\n  serve() {\n    const server = new EventSource(\"http://localhost:3000/stream/a\");\n    server.addEventListener(\"message\", event => {\n      if (event.data === \"Goodbye!\") {\n        console.log(\"Closing SSE connection\");\n        server.close();\n      } else {\n        console.log(event.data);\n      }\n    });\n\n    server.onerror = _event => {\n      console.log(\"Connection lost, reestablishing\");\n    };\n  }\n\n  login() {\n    var request = new XMLHttpRequest();\n    var form = new FormData();\n    form.append(\"password\", this.state.password);\n    form.append(\"username\", this.state.username);\n    sessionStorage.setItem(\"url\", this.state.url);\n    request.open(\"POST\", sessionStorage.getItem(\"url\") + \"/login\");\n    var that = this;\n\n    request.onreadystatechange = function () {\n      if (this.readyState !== 4) return;\n\n      if (this.status === 201) {\n        // login_modal.style.display = \"none\";\n        const data = JSON.parse(this.responseText);\n        that.setState({\n          password: \"\",\n          username: \"\",\n          needToLogin: false,\n          messageToken: data.message_token,\n          streamToken: data.stream_token\n        }); // start_stream();\n      } else if (this.status === 403) {\n        alert(\"Invalid username or password\");\n      } else if (this.status === 409) {\n        alert(this.state.username + \" is already logged in\");\n      } else {\n        alert(this.status + \" failure to /login\");\n      }\n    };\n\n    request.send(form);\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(Dialog, {\n        serve: this.serve,\n        login: this.login,\n        username: this.state.username,\n        password: this.state.password\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 9\n      }, this)\n    }, void 0, false);\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/app/src/App.jsx"],"names":["Component","App","constructor","props","state","username","password","needToLogin","messageToken","streamToken","url","serve","bind","login","server","EventSource","addEventListener","event","data","console","log","close","onerror","_event","request","XMLHttpRequest","form","FormData","append","sessionStorage","setItem","open","getItem","that","onreadystatechange","readyState","status","JSON","parse","responseText","setState","message_token","stream_token","alert","send","render"],"mappings":";AAAA,SAASA,SAAT,QAA0B,OAA1B;AACA,OAAO,WAAP;;;;AAEA,MAAMC,GAAN,SAAkBD,SAAlB,CAA4B;AAC1BE,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;AAEA,SAAKC,KAAL,GAAa;AACXC,MAAAA,QAAQ,EAAC,EADE;AAEXC,MAAAA,QAAQ,EAAC,EAFE;AAGXC,MAAAA,WAAW,EAAE,IAHF;AAIXC,MAAAA,YAAY,EAAE,EAJH;AAKXC,MAAAA,WAAW,EAAE,EALF;AAMXC,MAAAA,GAAG,EAAE;AANM,KAAb;AAQA,SAAKC,KAAL,GAAa,KAAKA,KAAL,CAAWC,IAAX,CAAgB,IAAhB,CAAb;AACA,SAAKC,KAAL,GAAa,KAAKA,KAAL,CAAWD,IAAX,CAAgB,IAAhB,CAAb;AACD;;AAECD,EAAAA,KAAK,GAAE;AACL,UAAMG,MAAM,GAAG,IAAIC,WAAJ,CAAgB,gCAAhB,CAAf;AACAD,IAAAA,MAAM,CAACE,gBAAP,CAAwB,SAAxB,EAAoCC,KAAD,IAAW;AAC5C,UAAIA,KAAK,CAACC,IAAN,KAAe,UAAnB,EAA+B;AAC7BC,QAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ;AACAN,QAAAA,MAAM,CAACO,KAAP;AACD,OAHD,MAGO;AACLF,QAAAA,OAAO,CAACC,GAAR,CAAYH,KAAK,CAACC,IAAlB;AACD;AACF,KAPD;;AAQAJ,IAAAA,MAAM,CAACQ,OAAP,GAAkBC,MAAD,IAAY;AAC3BJ,MAAAA,OAAO,CAACC,GAAR,CAAY,iCAAZ;AACD,KAFD;AAGD;;AAIDP,EAAAA,KAAK,GAAG;AACN,QAAIW,OAAO,GAAG,IAAIC,cAAJ,EAAd;AACA,QAAIC,IAAI,GAAG,IAAIC,QAAJ,EAAX;AACAD,IAAAA,IAAI,CAACE,MAAL,CAAY,UAAZ,EAAwB,KAAKxB,KAAL,CAAWE,QAAnC;AACAoB,IAAAA,IAAI,CAACE,MAAL,CAAY,UAAZ,EAAwB,KAAKxB,KAAL,CAAWC,QAAnC;AACAwB,IAAAA,cAAc,CAACC,OAAf,CAAuB,KAAvB,EAA8B,KAAK1B,KAAL,CAAWM,GAAzC;AACAc,IAAAA,OAAO,CAACO,IAAR,CAAa,MAAb,EAAqBF,cAAc,CAACG,OAAf,CAAuB,KAAvB,IAAgC,QAArD;AACA,QAAIC,IAAI,GAAG,IAAX;;AACAT,IAAAA,OAAO,CAACU,kBAAR,GAA6B,YAAW;AACpC,UAAI,KAAKC,UAAL,KAAoB,CAAxB,EAA2B;;AAC3B,UAAI,KAAKC,MAAL,KAAgB,GAApB,EAAyB;AACrB;AACA,cAAMlB,IAAI,GAAGmB,IAAI,CAACC,KAAL,CAAW,KAAKC,YAAhB,CAAb;AACAN,QAAAA,IAAI,CAACO,QAAL,CAAc;AACZlC,UAAAA,QAAQ,EAAE,EADE;AAEZD,UAAAA,QAAQ,EAAE,EAFE;AAGZE,UAAAA,WAAW,EAAE,KAHD;AAIZC,UAAAA,YAAY,EAAEU,IAAI,CAACuB,aAJP;AAKZhC,UAAAA,WAAW,EAAES,IAAI,CAACwB;AALN,SAAd,EAHqB,CAUrB;AACH,OAXD,MAWO,IAAI,KAAKN,MAAL,KAAgB,GAApB,EAAyB;AAC5BO,QAAAA,KAAK,CAAC,8BAAD,CAAL;AACH,OAFM,MAEA,IAAI,KAAKP,MAAL,KAAgB,GAApB,EAAyB;AAC5BO,QAAAA,KAAK,CAAC,KAAKvC,KAAL,CAAWC,QAAX,GAAsB,uBAAvB,CAAL;AACH,OAFM,MAEA;AACHsC,QAAAA,KAAK,CAAC,KAAKP,MAAL,GAAc,oBAAf,CAAL;AACH;AACJ,KApBD;;AAqBAZ,IAAAA,OAAO,CAACoB,IAAR,CAAalB,IAAb;AACD;;AAIHmB,EAAAA,MAAM,GAAG;AACP,wBACE;AAAA,6BACE,QAAC,MAAD;AAAQ,QAAA,KAAK,EAAE,KAAKlC,KAApB;AAA2B,QAAA,KAAK,EAAE,KAAKE,KAAvC;AAA8C,QAAA,QAAQ,EAAE,KAAKT,KAAL,CAAWC,QAAnE;AAA6E,QAAA,QAAQ,EAAE,KAAKD,KAAL,CAAWE;AAAlG;AAAA;AAAA;AAAA;AAAA;AADF,qBADF;AAKD;;AAzEyB;;AA2E5B,eAAeL,GAAf","sourcesContent":["import { Component } from \"react\";\nimport \"./App.css\";\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      username:\"\",\n      password:\"\",\n      needToLogin: true,\n      messageToken: \"\",\n      streamToken: \"\",\n      url: \"https://chat.cs291.com\"\n    }\n    this.serve = this.serve.bind(this)\n    this.login = this.login.bind(this)\n  }\n\n    serve(){\n      const server = new EventSource(\"http://localhost:3000/stream/a\");\n      server.addEventListener(\"message\", (event) => {\n        if (event.data === \"Goodbye!\") {\n          console.log(\"Closing SSE connection\");\n          server.close();\n        } else {\n          console.log(event.data);\n        }\n      });\n      server.onerror = (_event) => {\n        console.log(\"Connection lost, reestablishing\");\n      };\n    }\n\n\n\n    login() {\n      var request = new XMLHttpRequest();\n      var form = new FormData();\n      form.append(\"password\", this.state.password);\n      form.append(\"username\", this.state.username);\n      sessionStorage.setItem(\"url\", this.state.url);\n      request.open(\"POST\", sessionStorage.getItem(\"url\") + \"/login\");\n      var that = this;\n      request.onreadystatechange = function() {\n          if (this.readyState !== 4) return;\n          if (this.status === 201) {\n              // login_modal.style.display = \"none\";\n              const data = JSON.parse(this.responseText);\n              that.setState({\n                password: \"\",\n                username: \"\", \n                needToLogin: false,\n                messageToken: data.message_token,\n                streamToken: data.stream_token\n              })\n              // start_stream();\n          } else if (this.status === 403) {\n              alert(\"Invalid username or password\");\n          } else if (this.status === 409) {\n              alert(this.state.username + \" is already logged in\");\n          } else {\n              alert(this.status + \" failure to /login\");\n          }\n      };\n      request.send(form);\n    }\n\n  \n\n  render() {\n    return (\n      <>\n        <Dialog serve={this.serve} login={this.login} username={this.state.username} password={this.state.password}/>\n      </>\n    );\n  }\n}\nexport default App;\n"]},"metadata":{},"sourceType":"module"}