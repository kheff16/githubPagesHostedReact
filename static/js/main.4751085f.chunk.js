(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{80:function(e,t,s){},81:function(e,t,s){},91:function(e,t,s){"use strict";s.r(t);var n=s(0),a=s.n(n),r=s(29),o=s.n(r),i=(s(80),s(12)),c=s(33),u=s(19),d=s(20),l=s(32),h=s(24),p=s(23),j=(s(81),s(122)),g=s(2),b=function(e){Object(h.a)(s,e);var t=Object(p.a)(s);function s(){return Object(u.a)(this,s),t.apply(this,arguments)}return Object(d.a)(s,[{key:"postMessage",value:function(e){var t=sessionStorage.getItem("messageToken");if(null!==t&&13===e.keyCode&&(e.preventDefault(),""!==e.target.value)){var s=new FormData;s.append("message",e.target.value);var n=new XMLHttpRequest;n.open("POST",this.props.url+"/message"),n.setRequestHeader("Authorization","Bearer "+t),n.onreadystatechange=function(e){4===e.target.readyState&&403!==e.target.status&&null!==t&&(t=e.target.getResponseHeader("token"),sessionStorage.setItem("messageToken",t))},n.send(s),e.target.value=""}}},{key:"render",value:function(){var e=this;return Object(g.jsx)(j.a,{onKeyUp:function(t){return e.postMessage(t)},placeholder:this.props.needToLogin?"You need to log in before writting messages.":"Type a message here"})}}]),s}(n.Component),v=b,O=s(120),f=s(127),m=s(128),y=s(129),L=function(e){Object(h.a)(s,e);var t=Object(p.a)(s);function s(){return Object(u.a)(this,s),t.apply(this,arguments)}return Object(d.a)(s,[{key:"render",value:function(){var e=this;return Object(g.jsx)(O.a,{open:this.props.needToLogin,children:Object(g.jsx)(f.a,{p:5,children:Object(g.jsxs)(m.a,{children:[Object(g.jsxs)(f.a,{pb:2,children:[Object(g.jsx)(y.a,{children:"URL: "}),Object(g.jsx)(j.a,{onKeyUp:function(t){"Enter"===t.key&&e.props.login()},onChange:function(t){return e.props.setURL(t.target.value)},value:this.props.url})]}),Object(g.jsxs)(f.a,{pb:2,children:[Object(g.jsx)(y.a,{children:"Username: "}),Object(g.jsx)(j.a,{onKeyUp:function(t){"Enter"===t.key&&e.props.login()},onChange:function(t){return e.props.setUsername(t.target.value)},value:this.props.username})]}),Object(g.jsxs)(f.a,{id:"loginForm",children:[Object(g.jsx)(y.a,{id:"loginForm",children:"Password: "}),Object(g.jsx)(j.a,{id:"loginForm",type:"password",onKeyUp:function(t){"Enter"===t.key&&e.props.login()},onChange:function(t){return e.props.setPassword(t.target.value)},value:this.props.password})]})]})})})}}]),s}(n.Component),x=L,S=s(121),w=s(123),T=s(126),k=s(130),U=function(e){Object(h.a)(s,e);var t=Object(p.a)(s);function s(){var e;Object(u.a)(this,s);for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).scrollToBottom=function(){e.messagesEnd.scrollIntoView({behavior:"smooth"})},e}return Object(d.a)(s,[{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"render",value:function(){var e=this,t=this.props.events?this.props.events.map((function(e){var t,s=new Date(1e3*e.created).toLocaleDateString("en-US")+" "+new Date(1e3*e.created).toLocaleTimeString("en-US");switch(e.type){case"Message":t=e.user?"".concat(e.user," says: ").concat(e.message," at ").concat(s):"".concat(e.message," at ").concat(s);break;case"Join":t="JOIN ".concat(e.user," at ").concat(s);break;case"Part":t="PART ".concat(e.user," at ").concat(s);break;case"Status":t="STATUS ".concat(e.message," at ").concat(s);break;default:return""}return Object(g.jsx)(S.a,{disablePadding:!0,children:Object(g.jsx)(w.a,{primary:t})},e.created.toString())})):"no messages";return Object(g.jsx)(T.a,{style:{paddingLeft:"8px",height:"85vh",overflow:"auto"},children:Object(g.jsxs)(k.a,{style:{overflow:"auto"},children:[t,Object(g.jsx)("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}})]})})}}]),s}(n.Component),P=U,C=s(131),E=function(e){Object(h.a)(s,e);var t=Object(p.a)(s);function s(){return Object(u.a)(this,s),t.apply(this,arguments)}return Object(d.a)(s,[{key:"displayUserList",value:function(){return this.props.userList&&this.props.userList.length>0?this.props.userList.map((function(e){return Object(g.jsx)(S.a,{disablePadding:!0,children:Object(g.jsx)(w.a,{primary:e})},e)})):"no users"}},{key:"render",value:function(){return Object(g.jsx)(k.a,{style:{paddingLeft:"8px"},subheader:Object(g.jsx)(C.a,{component:"div",id:"nested-list-subheader",children:"User List"}),children:this.displayUserList()})}}]),s}(n.Component),D=E,J=s(132),F=s(125),R=function(e){Object(h.a)(s,e);var t=Object(p.a)(s);function s(e){var n;return Object(u.a)(this,s),(n=t.call(this,e)).state={userList:[],events:[],username:"",password:"",url:"",needToLogin:!0,streamToken:"",header:"Chat",composePlaceholder:"Enter a message to send"},n.serve=n.serve.bind(Object(l.a)(n)),n.login=n.login.bind(Object(l.a)(n)),n.setUsername=n.setUsername.bind(Object(l.a)(n)),n.setPassword=n.setPassword.bind(Object(l.a)(n)),n}return Object(d.a)(s,[{key:"login",value:function(){var e=new XMLHttpRequest,t=new FormData;t.append("password",this.state.password),t.append("username",this.state.username),e.open("POST",this.state.url+"/login");var s=this;e.onreadystatechange=function(){if(4===this.readyState)if(201===this.status){var e=JSON.parse(this.responseText);sessionStorage.setItem("messageToken",e.message_token),s.setState({password:"",username:"Loading...",streamToken:e.stream_token,needToLogin:!1}),s.serve()}else 403===this.status?alert("Invalid username or password"):409===this.status?alert(s.state.username+" is already logged in"):alert(this.status+" failure to /login")},e.send(t)}},{key:"serve",value:function(){var e=this,t=new EventSource("".concat(this.state.url,"/stream/").concat(this.state.streamToken));t.addEventListener("Part",(function(t){t=Object(c.a)(Object(c.a)({},JSON.parse(t.data)),{},{type:"Part"});var s=e.state.userList;s.splice(e.state.userList.indexOf(t.user),1),e.setState((function(e){return{userList:s,events:[].concat(Object(i.a)(e.events),[t]),needToLogin:!1}}))}),!1),t.addEventListener("open",(function(t){e.setState((function(e){return{username:"",needToLogin:!1}}))}),!1),t.addEventListener("Message",(function(t){var s=Object(c.a)(Object(c.a)({},JSON.parse(t.data)),{},{type:"Message"});e.setState((function(e){return{events:[].concat(Object(i.a)(e.events),[s]),needToLogin:!1}}))}),!1),t.addEventListener("Join",(function(t){var s=JSON.parse(t.data),n=Object(c.a)(Object(c.a)({},s),{},{type:"Join"});e.setState((function(e){return{header:"Chat",needToLogin:!1,events:[].concat(Object(i.a)(e.events),[n])}})),e.state.userList.includes(s.user)?e.setState((function(e){return{header:"Chat"}})):e.setState((function(e){return{userList:[].concat(Object(i.a)(e.userList),[s.user])}}))}),!1),t.addEventListener("Disconnect",(function(){t.close(),e.disconnect(),e.setState({events:[]})}),!1),t.addEventListener("ServerStatus",(function(t){var s=JSON.parse(t.data),n={message:s.status,created:s.created,type:"Status"};e.setState((function(t){return{events:[].concat(Object(i.a)(e.state.events),[n])}}))}),!1),t.addEventListener("Users",(function(t){e.setState((function(e){return{userList:JSON.parse(t.data).users}}))}),!1),t.addEventListener("error",(function(t){2===t.target.readyState?e.disconnect():(e.setState((function(e){return{header:"Disconnected, retrying"}})),console.log("Disconnected, retrying"))}),!1),t.onerror=function(e){console.log("Connection lost, reestablishing")}}},{key:"setUsername",value:function(e){this.setState({username:e})}},{key:"setPassword",value:function(e){this.setState({password:e})}},{key:"setURL",value:function(e){this.setState({url:e})}},{key:"disconnect",value:function(){this.setState((function(e){return{needToLogin:!0,messageToken:"",streamToken:"",userList:[]}}))}},{key:"render",value:function(){return this.state.needToLogin?Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)("header",{children:Object(g.jsx)(J.a,{style:{textAlign:"center"},children:"Log In to View Chat"})}),Object(g.jsx)("p",{children:"Not logged in"}),Object(g.jsx)(x,{url:this.state.url,setURL:this.setURL,setUsername:this.setUsername,setPassword:this.setPassword,needToLogin:this.state.needToLogin,serve:this.serve,login:this.login,username:this.state.username,password:this.state.password})]}):Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)("header",{children:Object(g.jsx)(J.a,{style:{textAlign:"center"},children:this.state.header})}),Object(g.jsx)(x,{setUsername:this.setUsername,setPassword:this.setPassword,needToLogin:this.state.needToLogin,serve:this.serve,login:this.login,username:this.state.username,password:this.state.password}),Object(g.jsxs)(F.a,{mt:2,container:!0,spacing:2,children:[Object(g.jsx)(F.a,{item:!0,xs:8,md:8,children:Object(g.jsxs)(T.a,{style:{display:"flex",flexWrap:"wrap",flexDirection:"column"},children:[Object(g.jsx)(P,{events:this.state.events}),Object(g.jsx)(v,{url:this.state.url,needToLogin:this.state.needToLogin})]})}),Object(g.jsx)(F.a,{item:!0,xs:4,md:4,children:Object(g.jsx)(T.a,{children:Object(g.jsx)(D,{userList:this.state.userList})})})]})]})}}]),s}(n.Component),I=function(e){e&&e instanceof Function&&s.e(3).then(s.bind(null,133)).then((function(t){var s=t.getCLS,n=t.getFID,a=t.getFCP,r=t.getLCP,o=t.getTTFB;s(e),n(e),a(e),r(e),o(e)}))};s(87),s(88),s(89),s(90);o.a.render(Object(g.jsx)(a.a.StrictMode,{children:Object(g.jsx)(R,{})}),document.getElementById("root")),I()}},[[91,1,2]]]);
//# sourceMappingURL=main.4751085f.chunk.js.map